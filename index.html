<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë®‚ÄçüöÄ Spacefarm 2.0 | 5% Loading...</title>
    <meta name="description" content="Spacefarm 2.0 - A retro-futuristic digital space station. System loading... Explore our cosmic construction site rendered in classic monochrome monitors.">
    <meta name="keywords" content="spacefarm, retro computing, monochrome graphics, 3D visualization, space station, obra dinn style">
    <meta name="author" content="Spacefarm">
    <meta name="theme-color" content="#000000">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000">
    <link rel="manifest" href="/manifest.json">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://spacefarm.digital/">
    <meta property="og:site_name" content="Spacefarm">
    <meta property="og:title" content="üë®‚ÄçüöÄ Spacefarm 2.0 | 5% Loading...">
    <meta property="og:description" content="A retro-futuristic digital space station rendered in classic monochrome monitors.">
    <meta property="og:image" content="https://spacefarm.digital/images/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Spacefarm 2.0 - Retro-futuristic space station">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://spacefarm.digital/">
    <meta name="twitter:title" content="üë®‚ÄçüöÄ Spacefarm 2.0 | 5% Loading...">
    <meta name="twitter:description" content="A retro-futuristic digital space station rendered in classic monochrome monitors.">
    <meta name="twitter:image" content="https://spacefarm.digital/images/og-image.jpg">
    <meta name="twitter:image:alt" content="Spacefarm 2.0 - Retro-futuristic space station">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cutive+Mono&display=swap" rel="stylesheet">

    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: 'Cutive Mono', monospace;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* --- Retro UI --- */
        #ui-layer {
            position: fixed;
            bottom: 40px;
            right: 40px;
            z-index: 10;
            text-align: center;
            background: transparent;
            padding: 15px 25px;
            border: 2px solid #ffffff;
            color: #ffffff;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            transition: color 0.3s, border-color 0.3s;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 300px;
        }

        .title-block {
            position: fixed;
            top: 40px;
            left: 50%; /* Center it */
            transform: translateX(-50%);
            z-index: 10;
            pointer-events: none;
            color: white; /* Overridden by JS */
            mix-blend-mode: difference;
            text-align: center;
            width: 80%;
        }

        h1 {
            font-size: 2.5rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            line-height: 1;
        }

        .subtitle {
            font-size: 1.2rem;
            margin-top: 10px;
            opacity: 0.9;
            text-transform: uppercase;
            min-height: 1.5em;
            transition: opacity 0.2s;
        }

        .typing-cursor::after {
            content: '‚ñà';
            animation: blink 1s infinite;
            margin-left: 5px;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Controls */
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: left;
        }

        label {
            display: block;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        select {
            background: transparent;
            border: 1px solid currentColor;
            color: currentColor;
            padding: 8px 12px;
            font-family: 'Cutive Mono', monospace;
            font-size: 1rem;
            text-transform: uppercase;
            cursor: pointer;
            outline: none;
            width: 100%;
            appearance: none;
        }

        select:hover { opacity: 0.8; }

        .select-wrapper { position: relative; width: 100%; }
        .select-wrapper::after {
            content: '‚ñº';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            font-size: 0.7em;
        }

        /* Instructions */
        .instructions {
            position: fixed;
            top: 40px;
            right: 40px;
            text-align: right;
            z-index: 10;
            color: white;
            mix-blend-mode: difference;
            font-size: 0.8rem;
            line-height: 1.5;
        }

        /* Left Header Text */
        .left-header {
            position: fixed;
            top: 40px;
            left: 40px;
            text-align: left;
            z-index: 10;
            color: white;
            mix-blend-mode: difference;
            font-size: 0.8rem;
            line-height: 1.5;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Footer Left Text */
        .footer-left {
            position: fixed;
            bottom: 40px;
            left: 40px;
            text-align: left;
            z-index: 10;
            color: white;
            mix-blend-mode: difference;
            font-size: 0.8rem;
            line-height: 1.5;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div class="left-header" id="left-header">
        SPACEFARM<br>2026
    </div>

    <div class="footer-left" id="footer-left">
        ALL RIGHTS RESERVED
    </div>

    <div class="title-block" id="main-title">
        <h1>Under Construction</h1>
        <div class="subtitle typing-cursor" id="system-message">System Rendering...</div>
    </div>

    <div class="instructions" id="instructions">
        DRAG TO ROTATE VIEW<br>
        SCROLL TO ZOOM<br>
        CLICK FOR FIREWORKS
    </div>

    <div id="ui-layer">
        <!-- Monitor Select -->
        <div class="control-group">
            <label for="monitor-select">Monitor</label>
            <div class="select-wrapper">
                <select id="monitor-select">
                    <option value="macintosh">Macintosh</option>
                    <option value="ibm5151">IBM 5151</option>
                    <option value="zenith">Zenith ZVM 1240</option>
                    <option value="commodore">Commodore 1084</option>
                    <option value="ibm8503">IBM 8503</option>
                    <option value="lcd">LCD</option>
                </select>
            </div>
        </div>

        <!-- Output Select -->
        <div class="control-group">
            <label for="output-select">Output</label>
            <div class="select-wrapper">
                <select id="output-select">
                    <option value="smooth">Smooth</option>
                    <option value="sharp" selected>Sharp (Default)</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

        // --- Monitor Presets (Exact Obra Dinn Colors) ---
        const PRESETS = {
            macintosh: {
                // Macintosh - Slightly greenish white on dark olive
                light: new THREE.Color(0xe5ffff),
                dark: new THREE.Color(0x333319),
                threshold: 0.5
            },
            ibm5151: {
                // IBM 5151 - Classic Phosphor Green
                light: new THREE.Color(0x01eb5f),
                dark: new THREE.Color(0x25342f),
                threshold: 0.5
            },
            zenith: {
                // Zenith ZVM 1240 - Amber phosphor
                light: new THREE.Color(0xffa652),
                dark: new THREE.Color(0x1d1508),
                threshold: 0.5
            },
            commodore: {
                // Commodore 1084 - Blue tint
                light: new THREE.Color(0x88d7de),
                dark: new THREE.Color(0x40318e),
                threshold: 0.45
            },
            ibm8503: {
                // IBM 8503 - Near black and white
                light: new THREE.Color(0xebe5ce),
                dark: new THREE.Color(0x2e3037),
                threshold: 0.6
            },
            lcd: {
                // Lower contrast, smoother greyish
                light: new THREE.Color(0xC0C5CE),
                dark: new THREE.Color(0x1D1F21),
                threshold: 0.5
            }
        };

        // --- Theme Detection ---
        // Determine if light theme should be used based on system preference or time of day
        function shouldUseLightTheme() {
            // Check if system has a color scheme preference
            if (window.matchMedia) {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
                const prefersLight = window.matchMedia('(prefers-color-scheme: light)');

                // If user has explicit preference, use it
                if (prefersDark.matches) return false;
                if (prefersLight.matches) return true;
            }

            // No system preference - use time of day
            // Light theme during daytime (6 AM to 6 PM), dark theme at night
            const hour = new Date().getHours();
            return hour >= 6 && hour < 18;
        }

        // Get preset with colors inverted for light theme
        function getThemedPreset(presetName) {
            const basePreset = PRESETS[presetName];
            const useLightTheme = shouldUseLightTheme();

            if (useLightTheme) {
                // Invert colors for light theme
                return {
                    light: basePreset.dark.clone(),
                    dark: basePreset.light.clone(),
                    threshold: basePreset.threshold
                };
            }

            return basePreset;
        }

        // --- Configuration ---
        let currentPreset = PRESETS.macintosh;
        let currentOutput = 'sharp';
        let logoTexture = null; // Defined at top level to avoid ReferenceError
        let logoGroup = null;

        // --- Scene Setup ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x808080);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 7);

        const renderer = new THREE.WebGLRenderer({ antialias: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 1.0;

        // --- Lighting ---
        // Increased ambient light for overall illumination
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        // Front-upper-right directional light
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
        dirLight.position.set(10, 10, 5);
        scene.add(dirLight);

        // Left-front point light
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(-5, 0, 2);
        scene.add(pointLight);

        // Back light to illuminate the back of the logo
        const backLight = new THREE.DirectionalLight(0xffffff, 1.2);
        backLight.position.set(-10, 5, -5);
        scene.add(backLight);

        // Bottom light to illuminate the underside
        const bottomLight = new THREE.PointLight(0xffffff, 0.8);
        bottomLight.position.set(0, -5, 0);
        scene.add(bottomLight);

        // Right side light for even coverage
        const rightLight = new THREE.PointLight(0xffffff, 0.8);
        rightLight.position.set(5, 0, 2);
        scene.add(rightLight);

        // --- Objects ---

        // 1. Logo (3D Text)
        logoGroup = new THREE.Group();
        scene.add(logoGroup);

        const loader = new FontLoader();
        loader.load('https://cdn.jsdelivr.net/npm/three@0.160.0/examples/fonts/helvetiker_bold.typeface.json', function (font) {
            const textGeo = new TextGeometry('SPACEFARM', {
                font: font,
                size: 1.2,
                height: 0.2,
                curveSegments: 4,
                bevelEnabled: false
            });

            textGeo.computeBoundingBox();
            const centerOffset = - 0.5 * (textGeo.boundingBox.max.x - textGeo.boundingBox.min.x);
            textGeo.translate(centerOffset, -0.4, 0);

            // Use MeshLambertMaterial so it reacts to light like the debris
            const textMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const textMesh = new THREE.Mesh(textGeo, textMaterial);
            logoGroup.add(textMesh);
        });

        // 2. Floating Debris
        const debrisGroup = new THREE.Group();
        const debrisMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
        scene.add(debrisGroup);

        // --- Voxel Fireworks System ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const particles = [];

        // Particle class to track individual voxels
        class Particle {
            constructor(position, velocity, color) {
                const size = 0.15 + Math.random() * 0.1; // Random size between 0.15-0.25
                const geometry = new THREE.BoxGeometry(size, size, size);
                const material = new THREE.MeshLambertMaterial({ color: color });
                this.mesh = new THREE.Mesh(geometry, material);
                this.mesh.position.copy(position);

                this.velocity = velocity;
                this.rotationSpeed = new THREE.Vector3(
                    (Math.random() - 0.5) * 0.2,
                    (Math.random() - 0.5) * 0.2,
                    (Math.random() - 0.5) * 0.2
                );
                this.lifetime = 0;
                this.maxLifetime = 120; // ~2 seconds at 60fps

                // Add to scene directly to avoid rotation drift from debrisGroup
                scene.add(this.mesh);
            }

            update() {
                // Apply velocity
                this.mesh.position.x += this.velocity.x;
                this.mesh.position.y += this.velocity.y;
                this.mesh.position.z += this.velocity.z;

                // Apply gravity
                this.velocity.y -= 0.003;

                // Apply rotation
                this.mesh.rotation.x += this.rotationSpeed.x;
                this.mesh.rotation.y += this.rotationSpeed.y;
                this.mesh.rotation.z += this.rotationSpeed.z;

                // Update lifetime
                this.lifetime++;

                // Fade out near end of life
                if (this.lifetime > this.maxLifetime * 0.7) {
                    const fadeProgress = (this.lifetime - this.maxLifetime * 0.7) / (this.maxLifetime * 0.3);
                    this.mesh.material.opacity = 1 - fadeProgress;
                    this.mesh.material.transparent = true;
                }

                return this.lifetime < this.maxLifetime;
            }

            destroy() {
                scene.remove(this.mesh);
                this.mesh.geometry.dispose();
                this.mesh.material.dispose();
            }
        }

        // Create firework explosion at a 3D position
        function createFirework(position) {
            const particleCount = 30 + Math.floor(Math.random() * 20); // 30-50 particles
            const preset = PRESETS[monitorSelect.value];

            for (let i = 0; i < particleCount; i++) {
                // Random direction for explosion
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.random() * Math.PI;
                const speed = 0.02 + Math.random() * 0.04;

                const velocity = new THREE.Vector3(
                    Math.sin(phi) * Math.cos(theta) * speed,
                    Math.sin(phi) * Math.sin(theta) * speed,
                    Math.cos(phi) * speed
                );

                // Alternate between light and dark colors from current preset
                const color = i % 2 === 0 ? preset.light : preset.dark;

                const particle = new Particle(position.clone(), velocity, color);
                particles.push(particle);
            }
        }

        // Update all particles
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const alive = particles[i].update();
                if (!alive) {
                    particles[i].destroy();
                    particles.splice(i, 1);
                }
            }
        }

        // Mouse click handler
        function onCanvasClick(event) {
            // Calculate mouse position in normalized device coordinates (-1 to +1)
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Cast ray from camera through mouse position
            raycaster.setFromCamera(mouse, camera);

            // Get point along the ray at a fixed distance (5 units from camera)
            const clickPosition = new THREE.Vector3();
            raycaster.ray.at(5, clickPosition);

            // Create firework at that position
            createFirework(clickPosition);
        }

        // Add click event listener
        renderer.domElement.addEventListener('click', onCanvasClick);

        // --- Post Processing ---
        const composer = new EffectComposer(renderer);
        const renderPass = new RenderPass(scene, camera);
        composer.addPass(renderPass);

        // Custom Dither Shader
        const DitherShader = {
            uniforms: {
                'tDiffuse': { value: null },
                'uResolution': { value: new THREE.Vector2(window.innerWidth, window.innerHeight) },
                'uLightColor': { value: currentPreset.light },
                'uDarkColor': { value: currentPreset.dark },
                'uThreshold': { value: currentPreset.threshold },
                'uPixelSize': { value: 1.0 }, // Controlled by Output
                'uDitherScale': { value: 2.0 } // Scale of dither pattern
            },
            vertexShader: `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            fragmentShader: `
                uniform sampler2D tDiffuse;
                uniform vec2 uResolution;
                uniform vec3 uLightColor;
                uniform vec3 uDarkColor;
                uniform float uThreshold;
                uniform float uPixelSize;
                uniform float uDitherScale;

                varying vec2 vUv;

                // 4x4 Bayer Matrix
                float bayer4x4(vec2 p) {
                    int x = int(mod(p.x, 4.0));
                    int y = int(mod(p.y, 4.0));
                    if (x == 0) { if (y == 0) return 0.0/16.0; if (y == 1) return 12.0/16.0; if (y == 2) return 3.0/16.0; return 15.0/16.0; }
                    if (x == 1) { if (y == 0) return 8.0/16.0; if (y == 1) return 4.0/16.0; if (y == 2) return 11.0/16.0; return 7.0/16.0; }
                    if (x == 2) { if (y == 0) return 2.0/16.0; if (y == 1) return 14.0/16.0; if (y == 2) return 1.0/16.0; return 13.0/16.0; }
                    if (x == 3) { if (y == 0) return 10.0/16.0; if (y == 1) return 6.0/16.0; if (y == 2) return 9.0/16.0; return 5.0/16.0; }
                    return 0.0;
                }

                void main() {
                    // Pixelize coordinate
                    vec2 pixelCoord = floor(gl_FragCoord.xy / uPixelSize);

                    // Scale the dither pattern
                    vec2 ditherCoord = floor(pixelCoord / uDitherScale);

                    // Sample texture with pixelization
                    vec2 pixelUv = floor(vUv * uResolution / uPixelSize) / (uResolution / uPixelSize);
                    vec4 texel = texture2D(tDiffuse, pixelUv);

                    float lum = dot(texel.rgb, vec3(0.299, 0.587, 0.114));

                    // Solid colors for darks and lights, dither only mid-tones
                    // This matches Obra Dinn's aesthetic: solid blacks and whites dominate
                    vec3 finalColor;
                    if (lum < 0.3) {
                        // Dark areas: solid dark color
                        finalColor = uDarkColor;
                    } else if (lum > 0.7) {
                        // Light areas: solid light color
                        finalColor = uLightColor;
                    } else {
                        // Mid-tones: use dithering
                        float ditherValue = bayer4x4(ditherCoord);
                        // Remap luminance from [0.3, 0.7] to [0, 1] for dithering
                        float remappedLum = (lum - 0.3) / 0.4;
                        finalColor = (remappedLum < ditherValue) ? uDarkColor : uLightColor;
                    }

                    gl_FragColor = vec4(finalColor, 1.0);
                }
            `
        };

        const ditherPass = new ShaderPass(DitherShader);
        composer.addPass(ditherPass);

        // --- UI Logic ---
        const monitorSelect = document.getElementById('monitor-select');
        const outputSelect = document.getElementById('output-select');
        const uiLayer = document.getElementById('ui-layer');
        const titleBlock = document.getElementById('main-title');
        const instructions = document.getElementById('instructions');
        const leftHeader = document.getElementById('left-header');
        const footerLeft = document.getElementById('footer-left');

        function updateSettings() {
            // Get themed preset (inverted for light mode)
            const preset = getThemedPreset(monitorSelect.value);
            const useLightTheme = shouldUseLightTheme();

            // Monitor Colors
            ditherPass.uniforms.uLightColor.value = preset.light;
            ditherPass.uniforms.uDarkColor.value = preset.dark;
            ditherPass.uniforms.uThreshold.value = preset.threshold;

            // Output Mode (Pixel Size)
            const outputMode = outputSelect.value;
            if (outputMode === 'sharp') {
                ditherPass.uniforms.uPixelSize.value = 2.0; // Moderate pixel blocks
                ditherPass.uniforms.uDitherScale.value = 2.0; // Moderate dither pattern
                if(logoTexture) {
                    logoTexture.minFilter = THREE.NearestFilter;
                    logoTexture.magFilter = THREE.NearestFilter;
                    logoTexture.needsUpdate = true;
                }
            } else {
                ditherPass.uniforms.uPixelSize.value = 1.0; // Smooth resolution
                ditherPass.uniforms.uDitherScale.value = 1.5; // Subtle dither scaling
                if(logoTexture) {
                    logoTexture.minFilter = THREE.LinearFilter;
                    logoTexture.magFilter = THREE.LinearFilter;
                    logoTexture.needsUpdate = true;
                }
            }

            // Update background color based on theme
            const bgColor = useLightTheme ? `#${preset.light.getHexString()}` : '#000';
            document.body.style.backgroundColor = bgColor;

            // Update UI layer - transparent with foreground color (matches bright logo color)
            const foregroundColor = `#${preset.light.getHexString()}`;
            uiLayer.style.backgroundColor = 'transparent';
            uiLayer.style.color = foregroundColor;
            uiLayer.style.borderColor = foregroundColor;

            // Update other UI elements with preset dark color for visibility
            const textColor = `#${preset.dark.getHexString()}`;
            titleBlock.style.color = textColor;
            instructions.style.color = textColor;
            leftHeader.style.color = textColor;
            footerLeft.style.color = textColor;

            // Update dropdown borders to foreground color (matches UI layer)
            document.querySelectorAll('select').forEach(el => {
                el.style.borderColor = foregroundColor;
            });

            // Update meta theme-color
            const metaThemeColor = document.querySelector('meta[name="theme-color"]');
            if (metaThemeColor) {
                metaThemeColor.setAttribute('content', bgColor);
            }
        }

        monitorSelect.addEventListener('change', updateSettings);
        outputSelect.addEventListener('change', updateSettings);

        // Listen for system color scheme changes
        if (window.matchMedia) {
            const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            const lightModeQuery = window.matchMedia('(prefers-color-scheme: light)');

            // Update theme when system preference changes
            darkModeQuery.addEventListener('change', updateSettings);
            lightModeQuery.addEventListener('change', updateSettings);
        }

        // Init
        updateSettings();


        // --- Animation Loop ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            if (logoGroup) {
                const time = Date.now() * 0.001;
                logoGroup.position.y = Math.sin(time) * 0.1;
                logoGroup.rotation.y = Math.sin(time * 0.5) * 0.1;
            }

            debrisGroup.rotation.y += 0.002;
            debrisGroup.rotation.x += 0.001;

            // Update firework particles
            updateParticles();

            composer.render();
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
            ditherPass.uniforms.uResolution.value.set(window.innerWidth, window.innerHeight);
        });

        animate();

    </script>
</body>
</html>
